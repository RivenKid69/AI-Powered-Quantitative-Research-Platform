# üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: Derived Features Validity Flags

## –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

**–ü—Ä–æ–±–ª–µ–º–∞**: `price_momentum` –∏ `trend_strength` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `isnan()` –≤–º–µ—Å—Ç–æ —É–∂–µ –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏.

**–†–µ—à–µ–Ω–∏–µ**: –ó–∞–º–µ–Ω–∏—Ç—å `isnan()` –Ω–∞ —Ñ–ª–∞–≥–∏ `momentum_valid`, `macd_valid`, `macd_signal_valid`.

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, –ø–æ–∫—Ä—ã—Ç–æ —Ç–µ—Å—Ç–∞–º–∏

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

### 1. obs_builder.pyx (2 –º–µ—Å—Ç–∞)

**–°—Ç—Ä–æ–∫–∞ 396** (`price_momentum`):
```diff
- if not isnan(momentum):
+ if momentum_valid:
```

**–°—Ç—Ä–æ–∫–∞ 435** (`trend_strength`):
```diff
- if not isnan(macd) and not isnan(macd_signal):
+ if macd_valid and macd_signal_valid:
```

### 2. –ù–æ–≤—ã–π —Ç–µ—Å—Ç: `tests/test_derived_features_validity_flags.py`
- 7 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –ü–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (valid/invalid)
- ~450 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

### 3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `CRITICAL_FIX_VERIFICATION.md`
- –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
- –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

---

## –î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤:

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Cython (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
pip3 install cython numpy

# 2. –ü–µ—Ä–µ–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å
rm -f obs_builder.c obs_builder*.so
python3 setup.py build_ext --inplace

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
pytest tests/test_derived_features_validity_flags.py -v

# –ò–õ–ò –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Python:
python3 tests/test_derived_features_validity_flags.py
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: **7/7 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ** ‚úÖ

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

‚úÖ **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –í—Å–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫ isnan()
‚úÖ **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: –ö–æ–¥ –ª–µ–≥—á–µ –ø–æ–Ω—è—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: 100% –ø–æ–∫—Ä—ã—Ç–∏–µ edge cases

---

**–î–µ—Ç–∞–ª–∏**: –°–º. `CRITICAL_FIX_VERIFICATION.md`
