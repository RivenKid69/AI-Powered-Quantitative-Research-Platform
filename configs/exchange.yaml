# -*- coding: utf-8 -*-
# Exchange Configuration for Multi-Exchange Support
#
# This configuration file defines exchange-specific settings.
# Select vendor to switch between Binance (crypto), Alpaca (stocks), or OANDA (forex).
#
# Usage:
#   from adapters.config import ExchangeConfig
#   config = ExchangeConfig.from_yaml("configs/exchange.yaml")
#   adapter = config.create_market_data_adapter()

# =============================================================================
# MAIN EXCHANGE SELECTION
# =============================================================================

# Exchange vendor: "binance", "binance_us", "alpaca", "oanda", "ig", "dukascopy"
vendor: "binance"

# Market type: CRYPTO_SPOT, CRYPTO_FUTURES, CRYPTO_PERP, EQUITY, EQUITY_OPTIONS, FOREX_SPOT
market_type: "CRYPTO_SPOT"


# =============================================================================
# BINANCE CONFIGURATION (Crypto)
# =============================================================================

binance:
  # API endpoints
  base_url: "https://api.binance.com"
  futures_url: "https://fapi.binance.com"
  use_futures: false
  timeout: 20

  # API credentials (use environment variables for security)
  # Format: ${ENV_VAR_NAME} or $ENV_VAR_NAME
  api_key: "${BINANCE_API_KEY}"
  api_secret: "${BINANCE_API_SECRET}"

  # Fee settings (basis points = 0.01%)
  maker_bps: 10.0    # 0.10% maker fee (default VIP0)
  taker_bps: 10.0    # 0.10% taker fee (default VIP0)
  use_bnb_discount: false  # 25% discount when paying fees in BNB
  vip_tier: 0        # VIP tier (0-9)

  # Cache paths
  filters_cache_path: "data/binance_filters.json"
  fees_cache_path: "data/fees/fees_by_symbol.json"


# =============================================================================
# ALPACA CONFIGURATION (US Equities)
# =============================================================================

alpaca:
  # API credentials (required)
  api_key: "${ALPACA_API_KEY}"
  api_secret: "${ALPACA_API_SECRET}"

  # Trading mode
  paper: true          # Use paper trading (recommended for testing)

  # Data feed: "iex" (free, 15-min delay) or "sip" (paid, real-time)
  feed: "iex"

  # Extended hours trading
  extended_hours: false        # Allow orders during extended hours
  allow_extended_hours: true   # Consider extended hours as "market open"

  # Regulatory fees
  include_regulatory_fees: true   # Include SEC/TAF fees in calculations
  options_per_contract_fee: 0.65  # Fee per options contract


# =============================================================================
# COMMON FEE OVERRIDES
# =============================================================================

fees:
  # Include regulatory fees (SEC/TAF for US equities)
  include_regulatory: true

  # Override maker/taker fees (null = use vendor defaults)
  custom_maker_bps: null
  custom_taker_bps: null


# =============================================================================
# TRADING HOURS CONFIGURATION
# =============================================================================

trading_hours:
  # Allow trading during extended hours (pre/post market for equities)
  allow_extended: true

  # Fetch calendar from exchange API
  use_exchange_calendar: true


# =============================================================================
# EXAMPLE CONFIGURATIONS
# =============================================================================

# --- Binance Crypto (Default) ---
# vendor: "binance"
# market_type: "CRYPTO_SPOT"
# binance:
#   use_futures: false
#   maker_bps: 10.0
#   taker_bps: 10.0

# --- Binance Futures ---
# vendor: "binance"
# market_type: "CRYPTO_PERP"
# binance:
#   use_futures: true
#   maker_bps: 2.0
#   taker_bps: 4.0

# --- Alpaca Stocks (Paper Trading) ---
# vendor: "alpaca"
# market_type: "EQUITY"
# alpaca:
#   paper: true
#   feed: "iex"
#   extended_hours: false

# --- Alpaca Stocks (Live Trading) ---
# vendor: "alpaca"
# market_type: "EQUITY"
# alpaca:
#   paper: false
#   feed: "sip"
#   extended_hours: true

# --- OANDA Forex (Paper Trading) ---
# vendor: "oanda"
# market_type: "FOREX_SPOT"
# oanda:
#   environment: practice
#   account_id: "${OANDA_ACCOUNT_ID}"

# --- OANDA Forex (Live Trading) ---
# vendor: "oanda"
# market_type: "FOREX_SPOT"
# oanda:
#   environment: live
#   account_id: "${OANDA_ACCOUNT_ID}"


# =============================================================================
# OANDA CONFIGURATION (Forex)
# =============================================================================

oanda:
  # API credentials (use environment variables for security)
  api_key: "${OANDA_API_KEY}"
  account_id: "${OANDA_ACCOUNT_ID}"

  # Environment: "practice" (paper trading) or "live"
  environment: "practice"

  # API endpoints (auto-selected based on environment)
  endpoints:
    practice:
      rest: "https://api-fxpractice.oanda.com"
      streaming: "https://stream-fxpractice.oanda.com"
    live:
      rest: "https://api-fxtrade.oanda.com"
      streaming: "https://stream-fxtrade.oanda.com"

  # Request timeout (seconds)
  timeout: 30

  # Rate limiting
  rate_limit:
    requests_per_second: 120
    burst: 200

  # Streaming configuration
  streaming:
    enabled: true
    heartbeat_interval: 5
    reconnect_delay: 1
    max_reconnect_attempts: 10

  # Default trading parameters
  trading:
    default_units: 100000        # 1 standard lot
    max_units_per_trade: 10000000
    allow_pending_orders: true

  # Session configuration
  session:
    rollover_time_et: 17          # 5pm ET
    weekend_filter: true
    dst_aware: true

  # Swap/rollover settings
  swap:
    enabled: true
    cache_path: "data/forex/oanda_swap_rates.json"
    cache_ttl_hours: 24


# =============================================================================
# IG CONFIGURATION (Forex)
# =============================================================================

ig:
  # API credentials
  api_key: "${IG_API_KEY}"
  username: "${IG_USERNAME}"
  password: "${IG_PASSWORD}"

  # Account type: "demo" or "live"
  account_type: "demo"

  # API endpoints
  endpoints:
    demo: "https://demo-api.ig.com"
    live: "https://api.ig.com"

  # Request timeout
  timeout: 30

  # Rate limiting (IG has stricter limits)
  rate_limit:
    requests_per_second: 30
    burst: 50


# =============================================================================
# DUKASCOPY CONFIGURATION (Historical Forex Data)
# =============================================================================

dukascopy:
  # API key (for historical data access)
  api_key: "${DUKASCOPY_API_KEY}"

  # Data configuration
  data:
    base_url: "https://datafeed.dukascopy.com"
    tick_data_enabled: true
    bar_data_enabled: true

  # Note: Dukascopy is primarily for historical data, not live trading


# =============================================================================
# FOREX-SPECIFIC SETTINGS
# =============================================================================

forex:
  # Default pair for testing
  default_pair: "EUR_USD"

  # Pip sizes
  pip_sizes:
    default: 0.0001
    jpy_pairs: 0.01

  # Lot sizes
  lot_sizes:
    standard: 100000
    mini: 10000
    micro: 1000
    nano: 100

  # Leverage (jurisdiction-dependent)
  leverage:
    retail_us: 50         # CFTC limit
    retail_eu: 30         # ESMA limit
    professional: 100
    institutional: 500

  # Session times (UTC)
  sessions:
    sydney:
      open: "21:00"
      close: "06:00"
    tokyo:
      open: "00:00"
      close: "09:00"
    london:
      open: "07:00"
      close: "16:00"
    new_york:
      open: "12:00"
      close: "21:00"
