# =============================================================================
# ASSET CLASS DEFAULTS CONFIGURATION (Phase 4.5 Unification)
# =============================================================================
#
# This file provides unified defaults for different asset classes. It serves as
# a reference for switching between crypto and equity trading configurations.
#
# Usage in main configs:
#   asset_class: crypto  # or equity
#   data_vendor: binance  # or alpaca, polygon
#
# The system auto-configures based on asset_class:
#   - FeeProvider: CryptoFeeProvider / EquityFeeProvider
#   - SlippageProvider: Crypto (5bps, k=0.1) / Equity (2bps, k=0.05)
#   - TradingHoursAdapter: 24/7 or NYSE calendar
#
# =============================================================================

# =============================================================================
# CRYPTO DEFAULTS
# =============================================================================
# Suitable for: Binance, Coinbase, Kraken, etc.
# Characteristics:
#   - 24/7 trading (no trading hours restrictions)
#   - Maker/taker fee structure (typically 2-10 bps)
#   - Higher volatility and wider spreads
#   - Liquidity seasonality by hour-of-week
# =============================================================================
crypto:
  # Core settings
  asset_class: crypto
  data_vendor: binance
  market: spot  # or futures

  # Trading hours: 24/7
  session:
    calendar: crypto_24x7
    pre_open_keepout_bars: 0
    post_close_keepout_bars: 0
    extended_hours: true  # N/A for crypto, always true

  # Fees: Maker/Taker model (Binance-style)
  fees:
    structure: maker_taker
    maker_bps: 2.0            # Default maker fee (VIP0 with BNB)
    taker_bps: 4.0            # Default taker fee (VIP0 with BNB)
    use_bnb_discount: true
    regulatory:
      enabled: false          # No regulatory fees for crypto
    path: "data/fees/fees_by_symbol.json"

  # Slippage: Higher impact model
  slippage:
    profile: crypto           # Reference: slippage.yaml profiles.crypto
    k: 0.10                   # Impact coefficient (Almgren-Chriss)
    default_spread_bps: 5.0   # Default half-spread
    min_slippage_bps: 1.0
    max_slippage_bps: 500.0

  # Execution
  execution:
    fill_policy: next_open_market
    timeframe_ms: 14400000    # 4H bars
    use_seasonality: true

  # Liquidity
  liquidity:
    min_adv_usd: 0            # No minimum
    min_bar_quote_volume: 0

  # No-trade windows (disabled by default for crypto)
  no_trade:
    enabled: false
    enforce_trading_hours: false

# =============================================================================
# US EQUITY DEFAULTS
# =============================================================================
# Suitable for: Alpaca, Polygon, Interactive Brokers
# Characteristics:
#   - NYSE/NASDAQ hours: 9:30-16:00 ET
#   - Commission-free with regulatory fees (SEC/TAF on sells)
#   - Tighter spreads, lower volatility
#   - Trading halts and circuit breakers
# =============================================================================
equity:
  # Core settings
  asset_class: equity
  data_vendor: alpaca         # or polygon
  market: equity

  # Trading hours: NYSE calendar
  session:
    calendar: us_equity       # NYSE 9:30-16:00 ET
    pre_open_keepout_bars: 0  # Optional: skip first N bars after open
    post_close_keepout_bars: 0
    extended_hours: false     # Pre-market (4:00-9:30) and after-hours (16:00-20:00)

  # Fees: Commission-free with regulatory fees
  fees:
    structure: flat           # Commission-free
    maker_bps: 0.0
    taker_bps: 0.0
    regulatory:
      enabled: true
      sec_fee_per_million: 27.80    # SEC Section 31 fee (~$0.0000278/dollar)
      taf_fee_per_share: 0.000166   # FINRA TAF (~$0.000166/share)
      taf_fee_cap: 8.30             # TAF cap per trade

  # Slippage: Lower impact model
  slippage:
    profile: equity           # Reference: slippage.yaml profiles.equity
    k: 0.05                   # Impact coefficient (lower than crypto)
    default_spread_bps: 2.0   # Tighter spreads
    min_slippage_bps: 0.5     # Penny tick protection
    max_slippage_bps: 200.0

  # Execution
  execution:
    fill_policy: next_open_market
    timeframe_ms: 14400000    # 4H bars
    use_seasonality: false    # No hour-of-week seasonality

  # Liquidity
  liquidity:
    min_adv_usd: 1000000      # $1M minimum ADV for tradeable stocks
    min_bar_quote_volume: 10000

  # Spread limits (stocks have tighter spreads)
  spreads:
    max_spread_bps: 50        # 0.5% max spread

  # No-trade windows
  no_trade:
    enabled: true
    policy: ignore            # ignore | hold | flatten
    enforce_trading_hours: true

# =============================================================================
# CRYPTO FUTURES DEFAULTS
# =============================================================================
# Suitable for: Binance Futures, FTX (RIP), Bybit
# Characteristics:
#   - 24/7 trading (like spot)
#   - Similar fee structure but often lower
#   - Funding rate considerations
#   - Higher leverage available
# =============================================================================
crypto_futures:
  # Core settings
  asset_class: crypto
  market: futures
  data_vendor: binance

  # Trading hours: 24/7
  session:
    calendar: crypto_24x7
    extended_hours: true

  # Fees: Similar to spot, often with volume discounts
  fees:
    structure: maker_taker
    maker_bps: 2.0
    taker_bps: 4.0
    funding_rate_enabled: true

  # Slippage: Slightly tighter than spot due to higher volume
  slippage:
    profile: crypto_futures
    k: 0.09
    default_spread_bps: 4.0
    min_slippage_bps: 0.5
    max_slippage_bps: 500.0

# =============================================================================
# FOREX DEFAULTS
# =============================================================================
# Suitable for: OANDA, IG, Dukascopy
# Characteristics:
#   - 24/5 trading (Sun 5pm - Fri 5pm ET)
#   - Spread-based fee structure (no commission for retail)
#   - OTC dealer market (not exchange LOB)
#   - High leverage available (50:1 to 500:1)
#   - Swap/rollover costs for overnight positions
# =============================================================================
forex:
  # Core settings
  asset_class: forex
  data_vendor: oanda           # or ig, dukascopy
  market: spot                 # or forward, swap

  # Trading hours: Forex 24/5
  session:
    calendar: forex_24x5       # Sun 5pm - Fri 5pm ET
    weekend_filter: true       # Filter out weekend gaps
    rollover_time_et: 17       # 5pm ET daily rollover
    rollover_keepout_minutes: 30
    dst_aware: true

  # Fees: Spread-only (retail)
  fees:
    structure: spread_only
    maker_bps: 0.0             # No maker/taker for retail forex
    taker_bps: 0.0
    swap_enabled: true
    swap_data_source: oanda
    regulatory:
      enabled: false           # No SEC/TAF for forex

  # Slippage: Lower than crypto, session-dependent
  slippage:
    profile: forex             # Reference: slippage.yaml profiles.forex
    k: 0.03                    # Impact coefficient (lower than crypto)
    default_spread_pips: 1.2   # EUR/USD typical retail spread
    min_slippage_pips: 0.1
    max_slippage_pips: 50.0

  # Execution
  execution:
    fill_policy: next_open_market
    timeframe_ms: 14400000     # 4H bars
    use_seasonality: true      # Session-based seasonality
    dealer_simulation: true    # OTC dealer simulation

  # Liquidity (varies by session)
  liquidity:
    min_adv_usd: 0
    session_liquidity: true    # Session-aware liquidity

  # Leverage
  leverage:
    max_leverage: 50.0         # CFTC limit for US retail
    default_leverage: 30.0
    margin_warning: 1.20       # 120% margin warning
    margin_call: 1.00          # 100% margin call
    stop_out: 0.50             # 50% stop-out

  # No-trade windows
  no_trade:
    enabled: true
    policy: hold               # Hold positions over weekend
    enforce_trading_hours: true
    weekend_filter: true
    rollover_keepout: true

# =============================================================================
# PROVIDER AUTO-SELECTION MAPPING
# =============================================================================
# This section documents how asset_class maps to execution providers.
# Used by execution_providers.create_execution_provider() and Mediator.
# =============================================================================
provider_mapping:
  crypto:
    fee_provider: CryptoFeeProvider
    slippage_provider: StatisticalSlippageProvider
    slippage_profile: crypto
    trading_hours_adapter: null  # 24/7, no adapter needed
    fill_provider: OHLCVFillProvider

  equity:
    fee_provider: EquityFeeProvider
    slippage_provider: StatisticalSlippageProvider
    slippage_profile: equity
    trading_hours_adapter: AlpacaTradingHoursAdapter  # or PolygonTradingHoursAdapter
    fill_provider: OHLCVFillProvider

  crypto_futures:
    fee_provider: CryptoFeeProvider
    slippage_provider: StatisticalSlippageProvider
    slippage_profile: crypto_futures
    trading_hours_adapter: null
    fill_provider: OHLCVFillProvider

  forex:
    fee_provider: ForexFeeProvider
    slippage_provider: ForexParametricSlippageProvider
    slippage_profile: forex
    trading_hours_adapter: ForexTradingHoursAdapter
    fill_provider: OHLCVFillProvider
    dealer_simulator: ForexDealerSimulator  # OTC-specific

# =============================================================================
# DATA VENDOR MAPPING
# =============================================================================
# Maps data_vendor to appropriate adapters and data sources.
# =============================================================================
data_vendor_mapping:
  binance:
    market_data_adapter: BinanceMarketDataAdapter
    exchange_info_adapter: BinanceExchangeInfoAdapter
    default_asset_class: crypto
    api_key_env: BINANCE_API_KEY
    api_secret_env: BINANCE_API_SECRET

  alpaca:
    market_data_adapter: AlpacaMarketDataAdapter
    exchange_info_adapter: AlpacaExchangeInfoAdapter
    order_execution_adapter: AlpacaOrderExecutionAdapter
    default_asset_class: equity
    api_key_env: ALPACA_API_KEY
    api_secret_env: ALPACA_API_SECRET
    feeds:
      - iex     # Free, 15-min delayed
      - sip     # Paid, real-time

  polygon:
    market_data_adapter: PolygonMarketDataAdapter
    exchange_info_adapter: PolygonExchangeInfoAdapter
    default_asset_class: equity
    api_key_env: POLYGON_API_KEY

  oanda:
    market_data_adapter: OandaMarketDataAdapter
    exchange_info_adapter: OandaExchangeInfoAdapter
    order_execution_adapter: OandaOrderExecutionAdapter
    fee_adapter: OandaFeeAdapter
    trading_hours_adapter: OandaTradingHoursAdapter
    default_asset_class: forex
    api_key_env: OANDA_API_KEY
    account_id_env: OANDA_ACCOUNT_ID
    environment: practice      # practice or live
    streaming:
      prices: true
      transactions: true

  ig:
    market_data_adapter: IGMarketDataAdapter
    exchange_info_adapter: IGExchangeInfoAdapter
    order_execution_adapter: IGOrderExecutionAdapter
    default_asset_class: forex
    api_key_env: IG_API_KEY
    username_env: IG_USERNAME
    password_env: IG_PASSWORD
    account_type: demo         # demo or live

  dukascopy:
    market_data_adapter: DukascopyMarketDataAdapter
    default_asset_class: forex
    api_key_env: DUKASCOPY_API_KEY
    # Historical data only (no live trading)

# =============================================================================
# VALIDATION RULES
# =============================================================================
# Validation rules to prevent misconfigurations.
# =============================================================================
validation:
  # asset_class + data_vendor compatibility
  compatible_combinations:
    crypto:
      - binance
    equity:
      - alpaca
      - polygon
    crypto_futures:
      - binance
    forex:
      - oanda
      - ig
      - dukascopy

  # session.calendar + asset_class compatibility
  calendar_compatibility:
    crypto:
      - crypto_24x7
    equity:
      - us_equity
      - us_equity_extended
    crypto_futures:
      - crypto_24x7
    forex:
      - forex_24x5

  # Warning conditions
  warnings:
    - condition: "asset_class == 'equity' and session.calendar == 'crypto_24x7'"
      message: "Equity asset_class with 24/7 calendar may not reflect real market hours"
    - condition: "asset_class == 'crypto' and fees.regulatory.enabled"
      message: "Crypto does not have SEC/TAF regulatory fees"
    - condition: "asset_class == 'forex' and leverage.max_leverage > 50"
      message: "Leverage exceeds CFTC 50:1 limit for US retail forex"
    - condition: "asset_class == 'forex' and session.weekend_filter == false"
      message: "Weekend gap risk: forex trading is closed on weekends"
    - condition: "asset_class == 'forex' and fees.swap_enabled == false"
      message: "Swap costs disabled - overnight positions will not account for financing"
